{
    "measurables": [
        { "tag": "V", "category": "states", "unit": "l" },
        { "tag": "A", "category": "states", "unit": "mol / l" },
        { "tag": "B", "category": "states", "unit": "mol / l" },
        { "tag": "F_out", "category": "algebraic_states", "unit": "l / s" },
        { "tag": "F_in", "category": "control_elements", "unit": "l / s" },
        { "tag": "k", "category": "constants", "unit": "1 / s" },
        { "tag": "Cv", "category": "constants", "unit": "l(1/2) / s" },
        { "tag": "CA_in", "category": "constants", "unit": "mol / l" }
    ],
    "control_elements": ["F_in"],
    "sensor_types": [
        {
            "name": "SampledDelayedSensor",
            "module": "modular_simulation.usables.sensors.sampled_delayed_sensor",
            "fields": [
                {
                    "name": "measurement_tag",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": "tag of the state or control element to measure."
                },
                {
                    "name": "alias_tag",
                    "type": "string",
                    "required": false,
                    "default": null,
                    "description": "alias of the measurement to be used when the sensor returns results.e.g., if measurement_tag was 'cumm_MI' and alias tag was 'lab_MI', then, a usable with tag 'lab_MI' will be available, while 'cumm_MI' would not be available."
                },
                {
                    "name": "unit",
                    "type": "unit",
                    "required": false,
                    "default": null,
                    "description": "Unit of the measured quantity."
                },
                {
                    "name": "description",
                    "type": "string",
                    "required": false,
                    "default": null,
                    "description": "Description of the sensor's measurement."
                },
                {
                    "name": "coefficient_of_variance",
                    "type": "number",
                    "required": false,
                    "default": 0.0,
                    "description": "the standard deviation of the measurement noise, defined as a fraction of the true value of measurement."
                },
                {
                    "name": "faulty_probability",
                    "type": "number",
                    "required": false,
                    "default": 0.0,
                    "description": "probability for the sensor to err (stall or spike)"
                },
                {
                    "name": "faulty_aware",
                    "type": "boolean",
                    "required": false,
                    "default": false,
                    "description": "whether or not the sensor knows it has erred. if True, the .ok field of the measurement result will be set automatically. if False, the .ok field of the measurement will not be set by the sensor routine. "
                },
                {
                    "name": "instrument_range",
                    "type": "tuple[number]",
                    "required": false,
                    "default": null,
                    "description": "the range of value this sensor can return. If true value is beyong the range, it is clipped and returned."
                },
                {
                    "name": "time_constant",
                    "type": "number",
                    "required": false,
                    "default": 0.0,
                    "description": "The timeconstant associated with the dynamics of this sensor. The final measurement is then filtered based on this time constant to mimic sensor dynamics. "
                },
                {
                    "name": "random_seed",
                    "type": "integer",
                    "required": false,
                    "default": 0,
                    "description": null
                },
                {
                    "name": "deadtime",
                    "type": "number",
                    "required": false,
                    "default": 0.0,
                    "description": "The measurement deadtime (a.k.a delay) in system units"
                },
                {
                    "name": "sampling_period",
                    "type": "number",
                    "required": false,
                    "default": 0.0,
                    "description": "The sampling period of the sensor in system units. This is how long it takes for new measurements to become available."
                }
            ],
            "doc": "A sensor with a set sampling frequency, measurement deadtime, and gaussian noise."
        }
    ],
    "controller_types": [
        {
            "name": "InternalModelController",
            "module": "modular_simulation.usables.controllers.IMC",
            "fields": [
                {
                    "name": "mv_tag",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": "The tag of the ControlElement corresponding to the manipulated variable (MV) for this controller."
                },
                {
                    "name": "cv_tag",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": "The tag of the UsableQuantities corresponding to themeasured or calculated controlled variable (CV) for this controller"
                },
                {
                    "name": "mv_range",
                    "type": "quantity_range",
                    "required": true,
                    "default": null,
                    "description": "Lower and upper bound of the manipulated variable, in that order."
                },
                {
                    "name": "ramp_rate",
                    "type": "string",
                    "required": false,
                    "default": null,
                    "description": "Optional rate limit for the controller setpoint in units per second. When provided, the requested setpoint from the trajectory will be ramped towards the target at no more than this rate during each update."
                },
                {
                    "name": "mode",
                    "type": "enum",
                    "required": false,
                    "default": "CASCADE",
                    "description": "Controller's mode - if AUTO, setpoint comes from the sp_trajectory provided. If CASCADE, setpoint comes from the cascade controller, if provided. If no cascade controller is provided, this mode will fall back to AUTO with a warning. "
                },
                {
                    "name": "model",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": "A model that takes as input the manipulated variable's value and returns the predicted controlled variable's value. "
                },
                {
                    "name": "sp_filter_factor",
                    "type": "number",
                    "required": false,
                    "default": 1.0,
                    "description": "first order filter factor on setpoint changes. "
                },
                {
                    "name": "solver_options",
                    "type": "string",
                    "required": false,
                    "default": { "tol": 0.001, "max_iter": 25 },
                    "description": "optional arguments for the minimize_scalar solver from scipy."
                }
            ],
            "doc": "Internal Model Control (IMC) implementation for SISO loops.\n\n``model`` may be a callable operating directly in system units or a\n:class:`Calculation` method referenced via :class:`CalculationModelPath`.\nDuring initialization the controller resolves the model, builds unit\nconverters between the calculation space and the system's manipulated\nvariable, and caches MV bounds in those units.  Each update solves a\nscalar optimization problem to minimize the predicted setpoint error while\nhonouring MV constraints and optional setpoint filtering."
        },
        {
            "name": "PIDController",
            "module": "modular_simulation.usables.controllers.PID",
            "fields": [
                {
                    "name": "mv_tag",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": "The tag of the ControlElement corresponding to the manipulated variable (MV) for this controller."
                },
                {
                    "name": "cv_tag",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": "The tag of the UsableQuantities corresponding to themeasured or calculated controlled variable (CV) for this controller"
                },
                {
                    "name": "mv_range",
                    "type": "quantity_range",
                    "required": true,
                    "default": null,
                    "description": "Lower and upper bound of the manipulated variable, in that order."
                },
                {
                    "name": "ramp_rate",
                    "type": "string",
                    "required": false,
                    "default": null,
                    "description": "Optional rate limit for the controller setpoint in units per second. When provided, the requested setpoint from the trajectory will be ramped towards the target at no more than this rate during each update."
                },
                {
                    "name": "mode",
                    "type": "enum",
                    "required": false,
                    "default": "CASCADE",
                    "description": "Controller's mode - if AUTO, setpoint comes from the sp_trajectory provided. If CASCADE, setpoint comes from the cascade controller, if provided. If no cascade controller is provided, this mode will fall back to AUTO with a warning. "
                },
                {
                    "name": "Kp",
                    "type": "number",
                    "required": true,
                    "default": null,
                    "description": "Proportional gain"
                },
                {
                    "name": "Ti",
                    "type": "number",
                    "required": false,
                    "default": "inf",
                    "description": "Integral time constant"
                },
                {
                    "name": "Td",
                    "type": "number",
                    "required": false,
                    "default": 0.0,
                    "description": "Derivative time constant"
                },
                {
                    "name": "inverted",
                    "type": "boolean",
                    "required": false,
                    "default": false,
                    "description": "If True, the controller assumes that higher control output -> lower pv."
                },
                {
                    "name": "derivative_filter_tc",
                    "type": "number",
                    "required": false,
                    "default": 0.0,
                    "description": "Time constant of the derivative filter used to smooth out derivative action"
                },
                {
                    "name": "setpoint_weight",
                    "type": "number",
                    "required": false,
                    "default": 1.0,
                    "description": "Used to implement the 2-DOF PID I-PD form. The setpoint weight for the proportional and derivative terms. the error for the P and D term are modified to be weight * setpoint - pv. if 1, corresponds to classic PID. if 0, corresponds to I-PD."
                }
            ],
            "doc": "A simple Proportional-Integral-Derivative controller.\nThe control output is return according to the time-domain formulation\n\nu(t) = Kp * (e(t) + 1/Ti * âˆ«(e*dt) + Td/dt * de(t)/dt)\n\nan optional filter may be applied to the derivative term to smooth out\ntaking the derivative of a noisy signal."
        },
        {
            "name": "BangBangController",
            "module": "modular_simulation.usables.controllers.bang_bang",
            "fields": [
                {
                    "name": "mv_tag",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": "The tag of the ControlElement corresponding to the manipulated variable (MV) for this controller."
                },
                {
                    "name": "cv_tag",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": "The tag of the UsableQuantities corresponding to themeasured or calculated controlled variable (CV) for this controller"
                },
                {
                    "name": "mv_range",
                    "type": "quantity_range",
                    "required": false,
                    "default": [0.0, 1.0],
                    "description": "limits assumed to correspond to off (first element) or on (second element)"
                },
                {
                    "name": "ramp_rate",
                    "type": "string",
                    "required": false,
                    "default": null,
                    "description": "Optional rate limit for the controller setpoint in units per second. When provided, the requested setpoint from the trajectory will be ramped towards the target at no more than this rate during each update."
                },
                {
                    "name": "mode",
                    "type": "enum",
                    "required": false,
                    "default": "CASCADE",
                    "description": "Controller's mode - if AUTO, setpoint comes from the sp_trajectory provided. If CASCADE, setpoint comes from the cascade controller, if provided. If no cascade controller is provided, this mode will fall back to AUTO with a warning. "
                },
                {
                    "name": "deadband",
                    "type": "number",
                    "required": true,
                    "default": null,
                    "description": "The deadband of the bang bang controller around the setpoint. The bang bang controller will try to maintaince the cv in the range of setpoint - deadband to setpoint + deadband."
                },
                {
                    "name": "alpha",
                    "type": "number",
                    "required": false,
                    "default": 1.0,
                    "description": "low pass filter factor on measurement. 1.0 = no filter"
                },
                {
                    "name": "inverted",
                    "type": "boolean",
                    "required": false,
                    "default": false,
                    "description": "If True, the controller inverts the on/off logic described in the documentation."
                }
            ],
            "doc": "bang-bang controller for either on or off controllers. \nDefault returns on_value starting from when the measurement goes below UL \nuntil when the measurement goes above HL. \nVice versa, will return off_value when measurement goes above HL\n until when the measurement goes below UL.\nThe mv range MUST have off value < on value, but \nthe default behavior can be INVERTED with the inverted flag."
        },
        {
            "name": "FirstOrderTrajectoryController",
            "module": "modular_simulation.usables.controllers.first_order_trajectory",
            "fields": [
                {
                    "name": "mv_tag",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": "The tag of the ControlElement corresponding to the manipulated variable (MV) for this controller."
                },
                {
                    "name": "cv_tag",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": "The tag of the UsableQuantities corresponding to themeasured or calculated controlled variable (CV) for this controller"
                },
                {
                    "name": "mv_range",
                    "type": "quantity_range",
                    "required": true,
                    "default": null,
                    "description": "Lower and upper bound of the manipulated variable, in that order."
                },
                {
                    "name": "ramp_rate",
                    "type": "string",
                    "required": false,
                    "default": null,
                    "description": "Optional rate limit for the controller setpoint in units per second. When provided, the requested setpoint from the trajectory will be ramped towards the target at no more than this rate during each update."
                },
                {
                    "name": "mode",
                    "type": "enum",
                    "required": false,
                    "default": "CASCADE",
                    "description": "Controller's mode - if AUTO, setpoint comes from the sp_trajectory provided. If CASCADE, setpoint comes from the cascade controller, if provided. If no cascade controller is provided, this mode will fall back to AUTO with a warning. "
                },
                {
                    "name": "closed_loop_time_constant_fraction",
                    "type": "number",
                    "required": false,
                    "default": 1.0,
                    "description": "The closed loop time constant used by the controller is defined as clos and computes\nthe manipulated variable that will drive the measured CV toward the\nsetpoint with a desired closed-loop time constant.  The open-loop time\nconstant may be provided directly or resolved from a measurement or\ncalculation tag at runtime."
                }
            ]
        }
    ],
    "calculation_types": [
        {
            "name": "FirstOrderFilter",
            "module": "modular_simulation.usables.calculations.first_order_filter",
            "fields": [
                {
                    "name": "name",
                    "type": "string",
                    "required": false,
                    "default": null,
                    "description": "Name of the calculation - optional."
                },
                {
                    "name": "filtered_signal_tag",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": null
                },
                {
                    "name": "raw_signal_tag",
                    "type": "string",
                    "required": true,
                    "default": null,
                    "description": null
                },
                {
                    "name": "time_constant",
                    "type": "number",
                    "required": false,
                    "default": 0.0,
                    "description": "time constant of this first order filter. "
                }
            ],
            "doc": "inputs and outputs tag names are expected to be annotated with the following info\n1. unit\n2. description - optional\n3. input/output/constant type\ne.g., input_one_tag: Annotated[str, TagAnnotation(TagType.INPUT), Unit('m'), 'this is input one']"
        }
    ],
    "usable_tags": [],
    "setpoint_tags": [],
    "messages": []
}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Modular Simulation Builder</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  </head>
  <body>
    <header>
      <h1>Modular Simulation Builder</h1>
      <p>Configure sensors, controllers, calculations, and plotting targets without writing code.</p>
    </header>

    <main>
      <section id="error-banner" class="panel hidden" role="alert"></section>
      <section id="messages" class="panel hidden"></section>

      <section class="panel">
        <h2>Configuration</h2>
        <div class="inline-form">
          <button id="export-config" type="button">Download Configuration</button>
          <label>Load configuration
            <input id="import-config" type="file" accept=".json,application/json" />
          </label>
        </div>
      </section>

      <section class="panel">
        <h2>Measurable Quantities</h2>
        <p>The system exposes the following measurable tags from states, algebraic variables, control elements, and constants.</p>
        <table id="measurables-table">
          <thead>
            <tr>
              <th>Tag</th>
              <th>Category</th>
              <th>Unit</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Sensors</h2>
          <button id="add-sensor" type="button">Add Sensor</button>
        </div>
        <form id="sensor-upload" class="inline-form">
          <label>Upload custom sensors (.py)
            <input type="file" name="file" accept=".py" />
          </label>
          <button type="submit">Upload</button>
        </form>
        <div id="sensor-form" class="dialog hidden"></div>
        <ul id="sensor-list" class="item-list"></ul>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Controllers</h2>
          <button id="add-controller" type="button">Add Controller</button>
        </div>
        <form id="controller-upload" class="inline-form">
          <label>Upload custom controllers (.py)
            <input type="file" name="file" accept=".py" />
          </label>
          <button type="submit">Upload</button>
        </form>
        <div id="controller-form" class="dialog hidden"></div>
        <ul id="controller-list" class="item-list"></ul>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Calculations</h2>
          <button id="add-calculation" type="button">Add Calculation</button>
        </div>
        <form id="calculation-upload" class="inline-form">
          <label>Upload custom calculation (.py)
            <input type="file" name="file" accept=".py" />
          </label>
          <button type="submit">Upload</button>
        </form>
        <div id="calculation-form" class="dialog hidden"></div>
        <ul id="calculation-list" class="item-list"></ul>
      </section>

      <section class="panel">
        <h2>Plot Configuration</h2>
        <form id="plot-form" class="grid-form">
          <label>Rows <input type="number" name="rows" min="1" value="1" /></label>
          <label>Columns <input type="number" name="cols" min="1" value="1" /></label>
          <button type="submit">Update Layout</button>
        </form>
        <div id="plot-line-form" class="dialog hidden"></div>
        <div id="plot-lines"></div>
        <button id="add-plot-line" type="button">Add Plot Line</button>
      </section>

      <section class="panel">
        <h2>Run Simulation</h2>
        <form id="run-form" class="inline-form">
          <label>Duration value <input type="number" step="any" name="duration_value" /></label>
          <label>Duration unit <input type="text" name="duration_unit" placeholder="s" /></label>
          <button type="submit">Run</button>
          <button id="reset-simulation" type="button">Reset</button>
        </form>
        <div id="run-status"></div>
        <div id="plot-output" class="plot-output hidden">
          <h3>Simulation Plot</h3>
          <img id="plot-image" alt="Simulation output" />
          <form id="time-axis-form" class="inline-form time-axis-controls">
            <label>Time min <input type="number" step="any" name="time_min" /></label>
            <label>Time max <input type="number" step="any" name="time_max" /></label>
            <button type="submit">Update Axis</button>
          </form>
          <p class="time-axis-hint" data-role="time-range"></p>
        </div>
      </section>
    </main>

    <script src="{{ url_for('static', filename='app.js') }}" type="module"></script>
  </body>
</html>
